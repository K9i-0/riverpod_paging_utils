# Riverpod 3.0移行 - PR分割計画

## 概要

Riverpod 3.0への移行を安全かつ確実に進めるため、作業を複数の小さなPRに分割します。各PRは独立してレビュー・マージ可能で、問題が発生した場合のロールバックも容易になります。

## PR分割戦略

### PR #1: 移行準備とドキュメント整備
**ブランチ名**: `feat/riverpod-3-migration-docs`
**目的**: 移行計画の文書化と準備作業

**作業内容**:
- [ ] `docs/migration-to-riverpod-3.0.md`の作成（完了済み）
- [ ] `docs/migration-pr-plan.md`の作成（このファイル）
- [ ] `.github/ISSUE_TEMPLATE/riverpod-3-migration.md`の作成
- [ ] 移行チェックリストの作成

**マージ条件**:
- ドキュメントレビューの完了
- チーム内での移行計画の合意

---

### PR #2: 依存関係の更新（プレリリース版）
**ブランチ名**: `feat/update-riverpod-3-dev`
**目的**: Riverpod 3.0-dev.15への依存関係更新

**作業内容**:
- [ ] `pubspec.yaml`の更新
  - `flutter_riverpod: ^3.0.0-dev.15`
  - `dependency_overrides`の追加
- [ ] `example/pubspec.yaml`の更新
- [ ] `melos.yaml`の更新
- [ ] `CHANGELOG.md`にプレリリース版のエントリ追加
- [ ] バージョンを`0.9.0-dev.1`に更新

**マージ条件**:
- `melos bs`が正常に完了
- 依存関係の解決が成功

---

### PR #3: 既存コードの互換性修正（最小限の変更）
**ブランチ名**: `feat/riverpod-3-compatibility`
**目的**: 破壊的変更への最小限の対応

**作業内容**:
- [ ] `AutoDisposeAsyncNotifier`を`AsyncNotifier`に変更
- [ ] `AutoDisposeAsyncNotifierProvider`を`AsyncNotifierProvider`に変更
- [ ] テストファイルの修正
- [ ] `Ref.watch`の使用箇所の確認（変更不要）

**マージ条件**:
- すべての既存テストがパス
- exampleアプリが正常に動作
- 既存のAPIに影響がないことの確認

---

### PR #4: テストの拡充と修正
**ブランチ名**: `feat/riverpod-3-test-updates`
**目的**: Riverpod 3.0に対応したテストの更新と拡充

**作業内容**:
- [ ] エラーハンドリングテストの更新（`ProviderException`対応）
- [ ] 自動リトライ機能のテスト追加
- [ ] `updateShouldNotify`の挙動変更に関するテスト
- [ ] パフォーマンステストの追加

**マージ条件**:
- テストカバレッジ80%以上
- すべてのテストがパス
- CI/CDパイプラインの成功

---

### PR #5: Exampleアプリの更新
**ブランチ名**: `feat/riverpod-3-example-update`
**目的**: サンプルアプリケーションの更新

**作業内容**:
- [ ] exampleアプリのコード更新
- [ ] 新機能のデモ追加（オプション）
- [ ] READMEの使用例更新
- [ ] スクリーンショットの更新（必要に応じて）

**マージ条件**:
- exampleアプリが正常に動作
- ドキュメントとの整合性

---

### PR #6: Mutation APIを使用した新実装（実験的）
**ブランチ名**: `feat/mutation-api-implementation`
**目的**: Mutation APIを活用した新しい実装の追加

**作業内容**:
- [ ] `lib/src/mutation/mutation_paging_notifier.dart`の作成
- [ ] `lib/src/mutation/mutation_paging_helper_view.dart`の作成
- [ ] `example/lib/pages/mutation_example_page.dart`の作成
- [ ] Mutation API用のテスト作成
- [ ] ドキュメントの追加

**マージ条件**:
- 既存APIとの共存が確認されている
- 実験的機能として明確にマーク
- テストカバレッジ

---

### PR #7: CI/CD設定の更新
**ブランチ名**: `feat/riverpod-3-ci-update`
**目的**: CI/CD環境のRiverpod 3.0対応

**作業内容**:
- [ ] GitHub Actionsワークフローの更新
- [ ] Flutter SDKバージョンの確認
- [ ] キャッシュ設定の最適化
- [ ] プレリリース版のパブリッシュ設定

**マージ条件**:
- すべてのワークフローが成功
- パブリッシュのドライランが成功

---

### PR #8: 最終調整とリリース準備
**ブランチ名**: `feat/riverpod-3-release-prep`
**目的**: プレリリース版の公開準備

**作業内容**:
- [ ] すべてのドキュメントの最終確認
- [ ] `CHANGELOG.md`の最終更新
- [ ] `README.md`にプレリリース版の注意事項追加
- [ ] マイグレーションガイドの公開
- [ ] pub.devへの公開準備

**マージ条件**:
- すべての前PRがマージ済み
- 最終的な動作確認完了
- チームの承認

## タイムライン

| 週 | PR | 作業内容 |
|---|---|---|
| 第1週 | PR #1, #2 | ドキュメント作成と依存関係更新 |
| 第2週 | PR #3, #4 | 互換性修正とテスト更新 |
| 第3週 | PR #5, #6 | Exampleアプリ更新と新機能実装 |
| 第4週 | PR #7, #8 | CI/CD更新とリリース準備 |

## リスク管理

### 各PRのリスクレベル

| PR | リスクレベル | 理由 | 対策 |
|---|---|---|---|
| #1 | 低 | ドキュメントのみ | - |
| #2 | 中 | 依存関係の変更 | dependency_overridesで制御 |
| #3 | 高 | コア機能の変更 | 十分なテストとレビュー |
| #4 | 低 | テストの追加・修正 | - |
| #5 | 低 | サンプルアプリのみ | - |
| #6 | 中 | 新機能（実験的） | 既存APIに影響しない設計 |
| #7 | 低 | CI/CD設定 | ドライラン実施 |
| #8 | 低 | リリース準備 | チェックリスト使用 |

## レビュープロセス

1. **セルフレビュー**: PR作成者が以下を確認
   - [ ] コードスタイルの一貫性
   - [ ] テストの実行と成功
   - [ ] ドキュメントの更新

2. **ピアレビュー**: 最低1名のレビュアーが確認
   - [ ] 実装の正確性
   - [ ] パフォーマンスへの影響
   - [ ] 後方互換性

3. **最終確認**: マージ前に確認
   - [ ] CI/CDの成功
   - [ ] 関連するIssueのリンク
   - [ ] CHANGELOGの更新

## 成功基準

- すべてのPRが計画通りにマージされる
- 既存ユーザーへの影響が最小限
- プレリリース版が正常に公開される
- フィードバックチャネルが確立される

## コミュニケーション計画

1. **内部コミュニケーション**
   - 週次進捗レポート
   - Slackでの日次アップデート
   - ブロッカーの即時共有

2. **外部コミュニケーション**
   - GitHubのリリースノート
   - pub.devのプレリリース表示
   - 移行ガイドの公開

## 次のステップ

1. このPR計画のレビューと承認
2. PR #1の作成（ドキュメント整備）
3. 移行用のGitHubプロジェクトボードの作成
4. 各PRのためのIssue作成